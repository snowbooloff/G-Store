import{v as h}from"./runtime-dom.esm-bundler-6a61cd91.js";import{b as L,c as N,I as P}from"./index-f6af960a.js";import{d as A,o as p,a as y,j as _,f as t,t as m,u as l,$ as D,r as w,h as G,q as R,y as B,a1 as V,l as E,g,_ as I,x as f,c as $,w as k,e as S,p as O,k as j,a4 as z}from"./runtime-core.esm-bundler-fd07f792.js";import{_ as T}from"./_plugin-vue_export-helper-c27b6911.js";import{N as M}from"./NavBarForEmpty-e7cf4316.js";import{S as U}from"./ShakeableWrapper-f4fddcb1.js";import{f as q}from"./fetchGameDetails-965aa644.js";import{r as W,g as H,a as J,c as K}from"./index.esm2017-64649ea8.js";import{l as v}from"./index-770713f3.js";import{u as Q}from"./vuex.esm-bundler-5129276b.js";import"./vue-router-5622f771.js";import"./index-30f3030e-585ad33e.js";const X={class:"shopping-item flex"},Y={class:"shopping-pannel flex"},Z={class:"shopping-details flex flex_column"},ee={class:"shopping-details__price main-blue"},te=A({__name:"ShoppingItem",props:{game:null},setup(s){const a=D("shoppingRemove");return(i,d)=>{const e=w("v-lazy-image"),c=w("icon-cross");return p(),y("article",X,[_(e,{class:"shopping-item_img",imgSrc:s.game.background_image,alt:s.game.name},null,8,["imgSrc","alt"]),t("div",Y,[t("div",Z,[_(L,{class:"shopping-details__title",gameId:s.game.id,gameName:s.game.name},null,8,["gameId","gameName"]),_(N,{class:"shopping-details__platforms",platforms:s.game.parent_platforms},null,8,["platforms"]),t("h3",ee,m(s.game.suggestions_count==0?"Free":"$"+s.game.suggestions_count/10),1)]),t("button",{class:"shopping-pannel__bttn cursor-pointer",onClick:d[0]||(d[0]=x=>l(a)(s.game))},[_(c,{class:"shopping-pannel__icon"})])])])}}});const se=T(te,[["__scopeId","data-v-9d20c57f"]]);function oe(s){const a=W(H());J(K(a,"Promo")).then(i=>{if(i.exists()){const e=i.val().find(c=>c.value===s.value);s.isChecked=!0,e?(s.isActive=!0,s.discount=e.discount,s.discountType=e.discountType):s.isActive=!1}}).catch(i=>{console.error(i)})}const u=s=>(O("data-v-c03a8ac3"),s=s(),j(),s),ie={class:"page-block flex flex_column"},ae={class:"page-block__title main-white"},ne={class:"shopping-block flex"},ce={key:2,class:"order-info"},le={class:"order-info__block flex flex_align-center"},_e=u(()=>t("h3",{class:"order-info__title main-white"},"Subtotal:",-1)),re={class:"order-info__price main-blue"},me={class:"order-info__block flex flex_align-center"},de=u(()=>t("h3",{class:"order-info__title main-white"},"Sales Tax:",-1)),pe={class:"order-info__price main-blue"},ue={class:"order-info__block flex flex_align-center"},he=u(()=>t("h3",{class:"order-info__title main-white"},"Grand Total:",-1)),ge={class:"order-info__price main-blue"},fe={class:"promo flex flex_column"},ve=u(()=>t("h3",{class:"promo__title main-white"},"Redeem Promo Code:",-1)),xe={class:"promo__status promo__status_red"},be={class:"promo__status promo__status_green"},ke=u(()=>t("button",{class:"order-info__bttn bttn bttn_buy"},"Checkout",-1)),Se=A({__name:"ShoppingView",setup(s){const a=Q(),i=G([]);R(()=>{const o=v.getList(v.shopping);o.length&&(a.commit("loading/setLoading",!0),o.forEach(n=>{const r=B({});q(r,n).then(()=>{i.value.push(r.value),i.value.length==o.length&&a.commit("loading/setLoading",!1)})}))}),z("shoppingRemove",d);function d(o){const n=i.value.indexOf(o);i.value.splice(n,1),v.placeItem(v.shopping,o.id),a.commit("notification/pushNotification",`${o.name}: removed from shopping cart`)}const e=V({isActive:!1,isChecked:!1,value:"",discount:0,discountType:""});E(e,()=>{e.value.length||(e.isChecked=!1,e.isActive=!1)});const c=g(()=>{let o;return o=i.value.reduce((n,r)=>n+=r.suggestions_count/10,0),e.discountType=="%"&&e.isActive?o=o-o/100*e.discount:e.discountType=="$"&&e.isActive&&(o=o-e.discount),parseFloat(o.toFixed(2))}),x=g(()=>{const o=c.value/79;return parseFloat(o.toFixed(2))}),F=g(()=>{const o=x.value+c.value;return parseFloat(o.toFixed(2))}),C=g(()=>a.state.loading.isLoading);return(o,n)=>{const r=w("v-input-submit");return p(),y("section",ie,[t("h1",ae,[I(" Shopping Cart "),f(t("span",{class:"page-block__count main-blue"},"("+m(i.value.length)+" items)",513),[[h,i.value.length]])]),t("div",ne,[!l(C)&&i.value.length?(p(),$(P,{key:0,class:"shopping-block__content game-list",itemsList:i.value},{item:k(b=>[_(se,{game:b.item},null,8,["game"])]),_:1},8,["itemsList"])):S("",!0),!l(C)&&!i.value.length?(p(),$(M,{key:1},{default:k(()=>[I(" Shopping list is empty ")]),_:1})):S("",!0),i.value.length?(p(),y("div",ce,[t("div",le,[_e,t("p",re,"$"+m(l(c)),1),f(t("p",{class:"order-info__discount main-white"},m("-"+e.discountType+e.discount),513),[[h,e.isActive]])]),t("div",me,[de,t("p",pe,"$"+m(l(x)),1)]),t("div",ue,[he,t("p",ge,"$"+m(l(F)),1)]),t("div",fe,[ve,_(U,{condition:e.isChecked&&!e.isActive},{default:k(()=>[_(r,{class:"promo__input",modelValue:e.value,"onUpdate:modelValue":n[0]||(n[0]=b=>e.value=b),maxlength:"15",placeholder:"PROMO1",submitFunc:l(oe),funcArguments:e},null,8,["modelValue","submitFunc","funcArguments"])]),_:1},8,["condition"]),f(t("span",xe,"Invalid promo",512),[[h,e.isChecked&&!e.isActive]]),f(t("span",be,"Promo activated",512),[[h,e.isChecked&&e.isActive]])]),ke])):S("",!0)])])}}});const Ge=T(Se,[["__scopeId","data-v-c03a8ac3"]]);export{Ge as default};
